<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>An optimized pipeline for Airbnb price prediction | Nina  Cilliers</title>
    <meta name="author" content="Nina  Cilliers">
    <meta name="description" content="A pipeline is developed to predict Airbnb rental Airbnb prices in Europe. The performance of six data preprocessing strategies was evaluated in nine models against two error metrics.">
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Bootstrap Table -->
    <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://ninacilliers.github.io/projects/air_bnb_pipeline/">

    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">NinaÂ </span>Cilliers</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">About</a>
              </li>
              

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">Publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">Projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/repositories/">Repositories</a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      
        <!-- page.html -->
        <style>
          img {
            max-width: 100%
          }
        </style>
        <div class="post">

          <article>
            <h1>An optimized pipeline for Airbnb price prediction</h1>
<h1> <br> </h1>
<h1>  Introduction</h1>

<p>A pipeline is developed to predict the price of Airbnb stays in Europe. An optimized pipeline for Airbnb price forecasting can identify key factors that impact the price of listings and provide insights into market trends and competitorsâ€™ offerings. By utilizing this pipeline to forecast future revenue based on these insights, hosts can make data-driven decisions that maximize their profits. This streamlined approach saves time, increases accuracy, and delivers the best possible experience to Airbnb guests. 
<br>
<br>
First, we carefully consider the range of prices of interest. Next, we develop several pre-processing strategies that utilize feature re-scaling and feature engineering. Next, we evaluate these strategies in conjunction with common models looking at two common error metrics. Extra trees and random forest regressors both perform, with extra trees performing the best. This model is combined with the optimal pre-processing strategy in a transferrable and concise final pipeline. 
<br>
<br>
<img src="/assets/img/airbnb_pipeline/airbnb_pic.webp" alt="img"></p>

<h1> <br>
</h1>
<h1>  Project Outline </h1>

<h3 href="#selecting">Selecting price range</h3>
<ul>
  <li>Raw data is imported from source</li>
  <li>Justification for outlier removal</li>
  <li>Outlier identification</li>
</ul>

<h3 id="exploratory-data-analysis">Exploratory data analysis</h3>
<ul>
  <li>Heat map</li>
  <li>Pair plots</li>
  <li>RBF definition</li>
  <li>Visualizing categorical data</li>
  <li>Visualizing rankings</li>
</ul>

<h3 id="data-preprocessing">Data preprocessing</h3>
<ul>
  <li>Encoding categorical data</li>
  <li>Building pipelines for model evaluation</li>
</ul>

<h3 id="price-prediction">Price prediction</h3>
<ul>
  <li>Sampling regression models with preprocessing strategies</li>
  <li>Optimizing extra trees regression model</li>
</ul>

<h3 id="conclusion">Conclusion</h3>
<ul>
  <li>The best performing model used an extra trees regressor with 500 estimators to predict the log of the price.</li>
  <li>This pipeline had mean squared error of 11,788.</li>
</ul>

<h1> <br> </h1>
<h1> <a id="selecting">  Selecting price range </a>
</h1>
<h2 id="importing-data">Importing data</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib</span> <span class="k">as</span> <span class="n">mpl</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">details</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">summary</span><span class="o">&gt;</span><span class="n">System</span> <span class="n">settings</span> <span class="ow">and</span> <span class="n">directory</span><span class="o">&lt;/</span><span class="n">summary</span><span class="o">&gt;</span>

  <span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">'</span><span class="s">ggplot</span><span class="sh">'</span><span class="p">)</span>
  <span class="n">pd</span><span class="p">.</span><span class="nf">set_option</span><span class="p">(</span><span class="sh">'</span><span class="s">display.max_columns</span><span class="sh">'</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
  <span class="c1">#set_config(transform_output="pandas") #doesn't work here :(
</span></code></pre></div></div>
<p>&lt;/details&gt;</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">os</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="sh">'</span><span class="s">/kaggle/input/airbnb-cleaned-europe-dataset</span><span class="sh">'</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">Aemf1.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">df</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>Price</th>
      <th>Day</th>
      <th>Room Type</th>
      <th>Shared Room</th>
      <th>Private Room</th>
      <th>Person Capacity</th>
      <th>Superhost</th>
      <th>Multiple Rooms</th>
      <th>Business</th>
      <th>Cleanliness Rating</th>
      <th>Guest Satisfaction</th>
      <th>Bedrooms</th>
      <th>City Center (km)</th>
      <th>Metro Distance (km)</th>
      <th>Attraction Index</th>
      <th>Normalised Attraction Index</th>
      <th>Restraunt Index</th>
      <th>Normalised Restraunt Index</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Amsterdam</td>
      <td>194.033698</td>
      <td>Weekday</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>2.0</td>
      <td>False</td>
      <td>1</td>
      <td>0</td>
      <td>10.0</td>
      <td>93.0</td>
      <td>1</td>
      <td>5.022964</td>
      <td>2.539380</td>
      <td>78.690379</td>
      <td>4.166708</td>
      <td>98.253896</td>
      <td>6.846473</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Amsterdam</td>
      <td>344.245776</td>
      <td>Weekday</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>4.0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>8.0</td>
      <td>85.0</td>
      <td>1</td>
      <td>0.488389</td>
      <td>0.239404</td>
      <td>631.176378</td>
      <td>33.421209</td>
      <td>837.280757</td>
      <td>58.342928</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Amsterdam</td>
      <td>264.101422</td>
      <td>Weekday</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>2.0</td>
      <td>False</td>
      <td>0</td>
      <td>1</td>
      <td>9.0</td>
      <td>87.0</td>
      <td>1</td>
      <td>5.748312</td>
      <td>3.651621</td>
      <td>75.275877</td>
      <td>3.985908</td>
      <td>95.386955</td>
      <td>6.646700</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Amsterdam</td>
      <td>433.529398</td>
      <td>Weekday</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>4.0</td>
      <td>False</td>
      <td>0</td>
      <td>1</td>
      <td>9.0</td>
      <td>90.0</td>
      <td>2</td>
      <td>0.384862</td>
      <td>0.439876</td>
      <td>493.272534</td>
      <td>26.119108</td>
      <td>875.033098</td>
      <td>60.973565</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Amsterdam</td>
      <td>485.552926</td>
      <td>Weekday</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>2.0</td>
      <td>True</td>
      <td>0</td>
      <td>0</td>
      <td>10.0</td>
      <td>98.0</td>
      <td>1</td>
      <td>0.544738</td>
      <td>0.318693</td>
      <td>552.830324</td>
      <td>29.272733</td>
      <td>815.305740</td>
      <td>56.811677</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>41709</th>
      <td>Vienna</td>
      <td>715.938574</td>
      <td>Weekend</td>
      <td>Entire home/apt</td>
      <td>False</td>
      <td>False</td>
      <td>6.0</td>
      <td>False</td>
      <td>0</td>
      <td>1</td>
      <td>10.0</td>
      <td>100.0</td>
      <td>3</td>
      <td>0.530181</td>
      <td>0.135447</td>
      <td>219.402478</td>
      <td>15.712158</td>
      <td>438.756874</td>
      <td>10.604584</td>
    </tr>
    <tr>
      <th>41710</th>
      <td>Vienna</td>
      <td>304.793960</td>
      <td>Weekend</td>
      <td>Entire home/apt</td>
      <td>False</td>
      <td>False</td>
      <td>2.0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>8.0</td>
      <td>86.0</td>
      <td>1</td>
      <td>0.810205</td>
      <td>0.100839</td>
      <td>204.970121</td>
      <td>14.678608</td>
      <td>342.182813</td>
      <td>8.270427</td>
    </tr>
    <tr>
      <th>41711</th>
      <td>Vienna</td>
      <td>637.168969</td>
      <td>Weekend</td>
      <td>Entire home/apt</td>
      <td>False</td>
      <td>False</td>
      <td>2.0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>10.0</td>
      <td>93.0</td>
      <td>1</td>
      <td>0.994051</td>
      <td>0.202539</td>
      <td>169.073402</td>
      <td>12.107921</td>
      <td>282.296424</td>
      <td>6.822996</td>
    </tr>
    <tr>
      <th>41712</th>
      <td>Vienna</td>
      <td>301.054157</td>
      <td>Weekend</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>2.0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>10.0</td>
      <td>87.0</td>
      <td>1</td>
      <td>3.044100</td>
      <td>0.287435</td>
      <td>109.236574</td>
      <td>7.822803</td>
      <td>158.563398</td>
      <td>3.832416</td>
    </tr>
    <tr>
      <th>41713</th>
      <td>Vienna</td>
      <td>133.230489</td>
      <td>Weekend</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>4.0</td>
      <td>True</td>
      <td>1</td>
      <td>0</td>
      <td>10.0</td>
      <td>93.0</td>
      <td>1</td>
      <td>1.263932</td>
      <td>0.480903</td>
      <td>150.450381</td>
      <td>10.774264</td>
      <td>225.247293</td>
      <td>5.444140</td>
    </tr>
  </tbody>
</table>
<p>41714 rows Ã— 19 columns</p>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="nf">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 41714 entries, 0 to 41713
Data columns (total 19 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   City                         41714 non-null  object 
 1   Price                        41714 non-null  float64
 2   Day                          41714 non-null  object 
 3   Room Type                    41714 non-null  object 
 4   Shared Room                  41714 non-null  bool   
 5   Private Room                 41714 non-null  bool   
 6   Person Capacity              41714 non-null  float64
 7   Superhost                    41714 non-null  bool   
 8   Multiple Rooms               41714 non-null  int64  
 9   Business                     41714 non-null  int64  
 10  Cleanliness Rating           41714 non-null  float64
 11  Guest Satisfaction           41714 non-null  float64
 12  Bedrooms                     41714 non-null  int64  
 13  City Center (km)             41714 non-null  float64
 14  Metro Distance (km)          41714 non-null  float64
 15  Attraction Index             41714 non-null  float64
 16  Normalised Attraction Index  41714 non-null  float64
 17  Restraunt Index              41714 non-null  float64
 18  Normalised Restraunt Index   41714 non-null  float64
dtypes: bool(3), float64(10), int64(3), object(3)
memory usage: 5.2+ MB
</code></pre></div></div>

<h2><br></h2>
<h2 id="selecting">Selecting price range</h2>

<p>Developing a general pricing model using extremely expensive stays that are likely outliers may not be appropriate or desirable. The price of extremely expensive stays may not be tied to features described in this dataset, such as luxury amenities or event hosting capabilities. Thus, extreme outliers will be identified and removed from the dataset.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">histplot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_8_0.png" alt="png"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>City</th>
      <th>Price</th>
      <th>Day</th>
      <th>Room Type</th>
      <th>Shared Room</th>
      <th>Private Room</th>
      <th>Person Capacity</th>
      <th>Superhost</th>
      <th>Multiple Rooms</th>
      <th>Business</th>
      <th>Cleanliness Rating</th>
      <th>Guest Satisfaction</th>
      <th>Bedrooms</th>
      <th>City Center (km)</th>
      <th>Metro Distance (km)</th>
      <th>Attraction Index</th>
      <th>Normalised Attraction Index</th>
      <th>Restraunt Index</th>
      <th>Normalised Restraunt Index</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3590</th>
      <td>Athens</td>
      <td>18545.450285</td>
      <td>Weekday</td>
      <td>Entire home/apt</td>
      <td>False</td>
      <td>False</td>
      <td>2.0</td>
      <td>True</td>
      <td>0</td>
      <td>1</td>
      <td>10.0</td>
      <td>100.0</td>
      <td>1</td>
      <td>1.196536</td>
      <td>0.381128</td>
      <td>134.904353</td>
      <td>5.086455</td>
      <td>275.573716</td>
      <td>20.691752</td>
    </tr>
    <tr>
      <th>24810</th>
      <td>Paris</td>
      <td>16445.614689</td>
      <td>Weekday</td>
      <td>Entire home/apt</td>
      <td>False</td>
      <td>False</td>
      <td>2.0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>9.0</td>
      <td>100.0</td>
      <td>1</td>
      <td>4.602378</td>
      <td>0.118665</td>
      <td>260.896109</td>
      <td>12.700335</td>
      <td>545.826245</td>
      <td>32.072497</td>
    </tr>
    <tr>
      <th>38387</th>
      <td>Vienna</td>
      <td>13664.305916</td>
      <td>Weekday</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>2.0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>9.0</td>
      <td>87.0</td>
      <td>1</td>
      <td>2.239501</td>
      <td>0.414395</td>
      <td>128.349070</td>
      <td>9.191812</td>
      <td>201.545043</td>
      <td>4.818080</td>
    </tr>
    <tr>
      <th>40794</th>
      <td>Vienna</td>
      <td>13656.358834</td>
      <td>Weekend</td>
      <td>Private room</td>
      <td>False</td>
      <td>True</td>
      <td>2.0</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>9.0</td>
      <td>87.0</td>
      <td>1</td>
      <td>2.239486</td>
      <td>0.414409</td>
      <td>128.349821</td>
      <td>9.191567</td>
      <td>201.546533</td>
      <td>4.871302</td>
    </tr>
    <tr>
      <th>38222</th>
      <td>Vienna</td>
      <td>12942.991375</td>
      <td>Weekday</td>
      <td>Entire home/apt</td>
      <td>False</td>
      <td>False</td>
      <td>4.0</td>
      <td>False</td>
      <td>0</td>
      <td>1</td>
      <td>7.0</td>
      <td>93.0</td>
      <td>1</td>
      <td>1.497979</td>
      <td>0.396893</td>
      <td>123.776241</td>
      <td>8.864325</td>
      <td>196.019793</td>
      <td>4.685995</td>
    </tr>
  </tbody>
</table>
</div>

<p>To identify outliers, the price distribution from the most expensive case, where the city is Amsterdam and the room capacity is 6, is used to identify outliers for the entire data set.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">scipy.stats</span> <span class="kn">import</span> <span class="n">zscore</span>

<span class="n">df_expensive</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">City</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">'</span><span class="s">Amsterdam</span><span class="sh">'</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Person Capacity</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="mf">6.0</span><span class="p">)]</span>

<span class="n">mean_val</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">df_expensive</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">])</span>
<span class="n">std_dev</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">df_expensive</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">])</span>

<span class="n">threshold</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">mean_val</span> <span class="o">-</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">std_dev</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">mean_val</span> <span class="o">+</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">std_dev</span>

<span class="n">df_no_outliers</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]</span><span class="o">&lt;</span><span class="n">upper_bound</span><span class="p">]</span> <span class="c1">#&amp;(z_scores&gt;-4)]
</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">With outliers exclusded..</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">New max price: $</span><span class="si">{</span><span class="n">upper_bound</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">New min price: $</span><span class="si">{</span><span class="n">lower_bound</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="n">sns</span><span class="p">.</span><span class="nf">histplot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df_no_outliers</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>With outliers exclusded..
New max price: $6315.60
New min price: $-2974.58
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_11_1.png" alt="outlier removed price histogram"></p>

<div class="alert alert-block alert-success" style="font-size:18px; font-family:verdana; line-height: 1.7em;">
    ðŸ“Œ Â  Prices above \$6,5000 will not be considered by this model, as these are likely anomalous listings influenced by factors beyond what is represented in our data set. Additional information on luxury amenities or event hosting capabilities is required for a general model to price these properties.  </div>

<h2><br></h2>
<h2 id="data-summary">Data summary</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">6500</span><span class="p">].</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="nf">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 41703 entries, 0 to 41713
Data columns (total 19 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   City                         41703 non-null  object 
 1   Price                        41703 non-null  float64
 2   Day                          41703 non-null  object 
 3   Room Type                    41703 non-null  object 
 4   Shared Room                  41703 non-null  bool   
 5   Private Room                 41703 non-null  bool   
 6   Person Capacity              41703 non-null  float64
 7   Superhost                    41703 non-null  bool   
 8   Multiple Rooms               41703 non-null  int64  
 9   Business                     41703 non-null  int64  
 10  Cleanliness Rating           41703 non-null  float64
 11  Guest Satisfaction           41703 non-null  float64
 12  Bedrooms                     41703 non-null  int64  
 13  City Center (km)             41703 non-null  float64
 14  Metro Distance (km)          41703 non-null  float64
 15  Attraction Index             41703 non-null  float64
 16  Normalised Attraction Index  41703 non-null  float64
 17  Restraunt Index              41703 non-null  float64
 18  Normalised Restraunt Index   41703 non-null  float64
dtypes: bool(3), float64(10), int64(3), object(3)
memory usage: 5.5+ MB
</code></pre></div></div>

<h1> <br> </h1>
<h1>  EDA </h1>

<h2 id="heat-map">Heat map</h2>

<p>Correlations between variables are visualized in the heat map below.</p>
<ul>
  <li>Cleaner rooms are rated higher.</li>
  <li>Attractions and restaurants are found in the same locations.</li>
  <li>City centers are closer to attractions and restaurants.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Heat map 
</span>
<span class="c1">#optimizng range for color scale
</span><span class="nb">min</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">corr</span><span class="p">().</span><span class="nf">min</span><span class="p">().</span><span class="nf">min</span><span class="p">()</span>
<span class="nb">max</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">corr</span><span class="p">()[</span><span class="n">df</span><span class="p">.</span><span class="nf">corr</span><span class="p">()</span><span class="o">!=</span><span class="mi">1</span><span class="p">].</span><span class="nf">max</span><span class="p">().</span><span class="nf">max</span><span class="p">()</span>

<span class="c1">#thresholding selected correlations
</span><span class="n">df_corr</span>  <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">corr</span><span class="p">()[</span><span class="n">np</span><span class="p">.</span><span class="nf">absolute</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nf">corr</span><span class="p">())</span><span class="o">&gt;</span><span class="mf">0.3</span><span class="p">]</span>

<span class="c1">#Mask for selecting only bottom triangle
</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">triu</span><span class="p">(</span><span class="n">df_corr</span><span class="p">)</span>

<span class="k">with</span> <span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">context</span><span class="p">(</span><span class="sh">'</span><span class="s">default</span><span class="sh">'</span><span class="p">):</span>
  <span class="n">sns</span><span class="p">.</span><span class="nf">heatmap</span><span class="p">(</span><span class="n">df_corr</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_16_0.png" alt="heat map"></p>

<h2><br></h2>
<h2 id="pair-plots">Pair plots</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#raw data 
</span><span class="n">sns</span><span class="p">.</span><span class="nf">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Attraction Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]],</span> <span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">hist</span><span class="sh">'</span><span class="p">,</span><span class="n">corner</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_18_0.png" alt="pair plots"></p>

<p>We see that these features are better represented in log space:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#rescaled data
</span><span class="n">df_trial</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>
<span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">])</span>
<span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">])</span>
<span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">Attraction Index</span><span class="sh">'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Attraction Index</span><span class="sh">'</span><span class="p">])</span>
<span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">])</span>
<span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">])</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">pairplot</span><span class="p">(</span><span class="n">df_trial</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">hist</span><span class="sh">'</span><span class="p">,</span><span class="n">corner</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_20_0.png" alt="log transformed pair plots"></p>

<h2><br></h2>
<h2 id="rbf-definition">RBF Definition</h2>
<p>We find a comparable radial basis function to describe features with an apparent radial price distribution in the above pair plots.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Metro, city center and restraunt index RBFs
</span>
<span class="kn">from</span> <span class="n">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">rbf_kernel</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">rbf_metro</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">rbf_kernel</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[[</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">]],[[</span><span class="o">-</span><span class="p">.</span><span class="mi">5</span><span class="p">]],</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">rbf_city</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">rbf_kernel</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[[</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">]],[[.</span><span class="mi">3</span><span class="p">]],</span> <span class="n">gamma</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">rbf_res</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">rbf_kernel</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[[</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">]],[[</span><span class="mf">6.25</span><span class="p">]],</span> <span class="n">gamma</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#visualizing metro rbf function
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Log Metro Distance (km)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">=</span><span class="n">ax1</span><span class="p">.</span><span class="nf">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">rbf_metro</span><span class="sh">'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Price rbf</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_23_0.png" alt="rbf metro"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#visualizing city rbf function
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Log City Center (km)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">=</span><span class="n">ax1</span><span class="p">.</span><span class="nf">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">rbf_city</span><span class="sh">'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">City rbf</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_24_0.png" alt="rbf city center"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#visualizing city rbf function
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Log Restraunt Index (km)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">=</span><span class="n">ax1</span><span class="p">.</span><span class="nf">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">df_trial</span><span class="p">[</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">rbf_res</span><span class="sh">'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">k</span><span class="sh">'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Restraunt rbf</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_25_0.png" alt="rbf restaurant"></p>

<h2><br></h2>
<h2 id="visualizing-categorical-data">Visualizing categorical data</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="p">.</span><span class="nf">set_size_inches</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">City</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">,</span><span class="n">showfliers</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1300</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_27_0.png" alt="price by city"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Superhost</span><span class="sh">'</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">,</span><span class="n">showfliers</span><span class="o">=</span><span class="bp">False</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_28_0.png" alt="superhost box plot"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">sca</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Room Type</span><span class="sh">'</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">,</span><span class="n">showfliers</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">sca</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Shared Room</span><span class="sh">'</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">,</span><span class="n">showfliers</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_29_0.png" alt="room type boxplot"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Day</span><span class="sh">'</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">,</span><span class="n">showfliers</span><span class="o">=</span><span class="bp">False</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_30_0.png" alt="day boxplot"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">Person Capacity</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">,</span><span class="n">showfliers</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_31_0.png" alt="capacity boxplot"></p>

<h2><br></h2>
<h2 id="visualizing-rankings">Visualizing rankings</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#sns.regplot(data = df[df["Price"]&lt;2000], x='Cleanliness Rating', y='Price',scatter=True,scatter_kws={'alpha':0.05},line_kws={"color": "black"});
</span><span class="n">sns</span><span class="p">.</span><span class="nf">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Cleanliness Rating</span><span class="sh">'</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]),</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">reg</span><span class="sh">'</span><span class="p">,</span><span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">alpha</span><span class="sh">'</span><span class="p">:</span><span class="mf">0.05</span><span class="p">},</span><span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">})</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_33_0.png" alt="cleanliness rating"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#sns.regplot(data = df[df['Price']&lt;2000], x='Guest Satisfaction', y='Price',scatter_kws={'alpha':0.05},line_kws={"color": "black"})
</span><span class="n">sns</span><span class="p">.</span><span class="nf">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Guest Satisfaction</span><span class="sh">'</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">]),</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">reg</span><span class="sh">'</span><span class="p">,</span><span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">alpha</span><span class="sh">'</span><span class="p">:</span><span class="mf">0.05</span><span class="p">},</span><span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">})</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_34_0.png" alt="guest satisfaction"></p>

<h1><br></h1>
<h1>  Data preprocessing </h1>

<h4 id="column-transformers-are-developed-to-evaluate-the-effect-of-three-different-preprocessing-strategies-on-model-efficacy">Column transformers are developed to evaluate the effect of three different preprocessing strategies on model efficacy.</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">TransformedTargetRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="n">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">from</span> <span class="n">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#defining functions for column transformer
</span>
<span class="n">cat_encoder</span> <span class="o">=</span> <span class="nc">OneHotEncoder</span><span class="p">()</span>

<span class="n">log_pipeline</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span>
    <span class="nc">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">),</span> <span class="c1">#, inverse_func=np.exp),
</span>    <span class="nc">MinMaxScaler</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">day_2_num</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">X</span><span class="o">==</span><span class="sh">'</span><span class="s">Weekend</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">day_pipeline</span><span class="p">():</span>
    <span class="k">return</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="nc">FunctionTransformer</span><span class="p">(</span><span class="n">day_2_num</span><span class="p">))</span>
        
<span class="n">day_pipe</span> <span class="o">=</span> <span class="nf">day_pipeline</span><span class="p">()</span>
</code></pre></div></div>
<h2><br></h2>
<h2 id="1-standard-preprocessing">1. Standard preprocessing</h2>
<ul>
  <li>Normalized attraction index and restaurant index are not used</li>
  <li>Data is scaled using a min-max scaling strategy</li>
  <li>Restaurant index, attraction index, city center and metro index are log-transformed.</li>
  <li>Room type and city are encoded.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#defining standard column transformer
</span><span class="n">preprocessing</span> <span class="o">=</span> <span class="nc">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">,</span> <span class="n">day_pipe</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">Day</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">drop</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">drop</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">Normalised Attraction Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Normalised Restraunt Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rbf_metro</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rbf_city</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rbf_res</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">pass</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">passthrough</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">Private Room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Shared Room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Superhost</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Business</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Multiple Rooms</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">maxscale</span><span class="sh">'</span><span class="p">,</span> <span class="nc">MinMaxScaler</span><span class="p">(),[</span><span class="sh">'</span><span class="s">Cleanliness Rating</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Bedrooms</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Guest Satisfaction</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">log</span><span class="sh">'</span><span class="p">,</span><span class="n">log_pipeline</span><span class="p">,[</span><span class="sh">'</span><span class="s">Attraction Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">cat</span><span class="sh">'</span><span class="p">,</span> <span class="n">cat_encoder</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">Room Type</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">City</span><span class="sh">'</span><span class="p">])</span>
<span class="p">])</span>
</code></pre></div></div>
<h2><br></h2>
<h2 id="2-preprocessing-using-developed-rbfs">2. Preprocessing using developed RBFs</h2>
<ul>
  <li>Normalized attraction index and restaurant index are not used</li>
  <li>Data is scaled using a min-max scaling strategy</li>
  <li>Attraction index is log-transformed.</li>
  <li>Restaurant index, metro index, and city center are replaced with the RBF functions developed during EDA.</li>
  <li>Room type and city are encoded.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#column transformer with rbf functions instead of metro, city, and restraunts
</span><span class="n">preprocessing_rbf</span> <span class="o">=</span> <span class="nc">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">,</span> <span class="n">day_pipe</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">Day</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">drop</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">drop</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">Normalised Attraction Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Normalised Restraunt Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">pass</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">passthrough</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">Private Room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Shared Room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Superhost</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Business</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Multiple Rooms</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">maxscale</span><span class="sh">'</span><span class="p">,</span> <span class="nc">MinMaxScaler</span><span class="p">(),[</span><span class="sh">'</span><span class="s">Cleanliness Rating</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Bedrooms</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Guest Satisfaction</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">log</span><span class="sh">'</span><span class="p">,</span><span class="n">log_pipeline</span><span class="p">,[</span><span class="sh">'</span><span class="s">Attraction Index</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">pass2</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">passthrough</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">rbf_metro</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rbf_city</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rbf_res</span><span class="sh">'</span><span class="p">]),</span>                 
    <span class="p">(</span><span class="sh">'</span><span class="s">cat</span><span class="sh">'</span><span class="p">,</span> <span class="n">cat_encoder</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">Room Type</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">City</span><span class="sh">'</span><span class="p">])</span>
<span class="p">])</span>
</code></pre></div></div>
<h2><br></h2>
<h2 id="3-preprocessing-using-given-normalized-restaurant-and-attraction-indexes">3. Preprocessing using given normalized restaurant and attraction indexes</h2>
<ul>
  <li>Data is scaled using a min-max scaling strategy</li>
  <li>City center and metro index are log-transformed.</li>
  <li>Room type and city are encoded.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#column transformer with given normalized features
</span><span class="n">preprocessing_norm</span> <span class="o">=</span> <span class="nc">ColumnTransformer</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">day</span><span class="sh">'</span><span class="p">,</span> <span class="n">day_pipe</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">Day</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">drop</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">drop</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">Attraction Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rbf_metro</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rbf_city</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">rbf_res</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">pass</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">passthrough</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">Private Room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Shared Room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Superhost</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Business</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Multiple Rooms</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">maxscale</span><span class="sh">'</span><span class="p">,</span> <span class="nc">MinMaxScaler</span><span class="p">(),[</span><span class="sh">'</span><span class="s">Cleanliness Rating</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Bedrooms</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Guest Satisfaction</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">pass2</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">passthrough</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">Normalised Attraction Index</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">log</span><span class="sh">'</span><span class="p">,</span><span class="n">log_pipeline</span><span class="p">,[</span><span class="sh">'</span><span class="s">City Center (km)</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Metro Distance (km)</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">pass3</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">passthrough</span><span class="sh">'</span><span class="p">,[</span><span class="sh">'</span><span class="s">Normalised Restraunt Index</span><span class="sh">'</span><span class="p">]),</span>
    <span class="p">(</span><span class="sh">'</span><span class="s">cat</span><span class="sh">'</span><span class="p">,</span> <span class="n">cat_encoder</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">Room Type</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">City</span><span class="sh">'</span><span class="p">])</span>
<span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#naming output columns
</span><span class="n">names</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">([</span><span class="sh">'</span><span class="s">Weekend</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Private Room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Shared Room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Superhost</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Business</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Multiple Rooms</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Cleanliness Rating</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Bedrooms</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Guest Satisfaction</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Attraction Index</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">City Center</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Metro Distance</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Restraunt Index</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Private room</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Entire home/apt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Shared room</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Amsterdam</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Athens</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Barcelona</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Berlin</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Budapest</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Lisbon</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Paris</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Rome</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Vienna</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#transforming data
</span><span class="n">df_processed</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">preprocessing</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">names</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#splitting data into test and train sets 
</span><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">].</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">Price</span><span class="sh">'</span><span class="p">})</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="nf">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<h1><br></h1>
<h1>  Price prediction </h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#importing packages
</span><span class="kn">from</span> <span class="n">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">ElasticNet</span>
<span class="kn">from</span> <span class="n">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">ExtraTreesRegressor</span><span class="p">,</span> <span class="n">AdaBoostRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="n">xgboost</span> <span class="k">as</span> <span class="n">xgb</span>
<span class="kn">from</span> <span class="n">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span> 
</code></pre></div></div>
<h2><br></h2>
<h2 id="sampling-regression-models-with-preprocessing-strategies">Sampling regression models with preprocessing strategies</h2>
<p>Common regression models were evaluated with six variations:</p>

<ol>
  <li>Standard preprocessing</li>
  <li>Standard preprocessing with price target log-transformed</li>
  <li>Standard preprocessing with dimensionality reduction via PCA</li>
  <li>Preprocessing using RBFs</li>
  <li>Preprocessing using provided normalized restaurant and attraction indexes</li>
  <li>Combining variations 2-4</li>
</ol>

<p>To evaluate model performance, mean absolute percentage error (MAPE) and mean squared error (MSE) were both used. MSE measures the average squared difference between the predicted values and the actual values. MAPE measures the average percentage difference between the predicted values and the actual values. Unlike MSE, MAPE is a relative measure and is expressed in percentage terms.</p>

<p>MAPE is particularly useful when the data contains large values or outliers, as it gives equal weight to all the data points regardless of their scale. This can be important because MSE is sensitive to outliers and large values. When you have large data points, their influence on the modelâ€™s performance can skew the results of MSE, making it harder to determine the accuracy of the model. By including MAPE in the evaluation, you can better assess how well the model is predicting the target variable, even in the presence of large data points.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#defining mean absolute percentage error 
</span><span class="k">def</span> <span class="nf">mape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_true</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#selected models
</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="nc">Ridge</span><span class="p">(),</span> <span class="nc">ElasticNet</span><span class="p">(),</span> <span class="nc">SVR</span><span class="p">(),</span><span class="nc">KNeighborsRegressor</span><span class="p">(),</span> <span class="nc">RandomForestRegressor</span><span class="p">(),</span> <span class="nc">ExtraTreesRegressor</span><span class="p">(),</span> <span class="nc">AdaBoostRegressor</span><span class="p">(),</span> <span class="nc">GradientBoostingRegressor</span><span class="p">(),</span> <span class="n">xgb</span><span class="p">.</span><span class="nc">XGBRegressor</span><span class="p">()]</span>
<span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Ridge</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ElasticNet</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">SVR</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">K-nearest neighbors</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Random Forest</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Extra Trees</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Adaptive Boosting</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Gradient Boosting</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">XGBoost</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#y
</span><span class="n">mse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mape_err</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">sample_pipe</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="n">preprocessing</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">sample_pipe</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">sample_pipe</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">mse</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">mape_err</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#log y
</span><span class="n">scaled_mse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">scaled_mape</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">scaled_pipe</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="n">preprocessing</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">scaled_pipe</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">scaled_pipe</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="n">scaled_mse</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">scaled_mape</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#with dimensionality reduction
</span><span class="n">pca</span> <span class="o">=</span> <span class="nc">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="p">.</span><span class="mi">95</span><span class="p">)</span>
<span class="n">pca_mse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pca_mape</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">pca_pipe</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="n">preprocessing</span><span class="p">,</span> <span class="n">pca</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">pca_pipe</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pca_pipe</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">pca_mse</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">pca_mape</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#with rbf 
</span><span class="n">rbf_mse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rbf_mape</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">rbf_pipe</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="n">preprocessing_rbf</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">rbf_pipe</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">rbf_pipe</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">rbf_mse</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">rbf_mape</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#with provided normalized features
</span><span class="n">norm_mse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">norm_mape</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">norm_pipe</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="n">preprocessing_norm</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">norm_pipe</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">norm_pipe</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">norm_mse</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">norm_mape</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#combination 
</span><span class="n">combo_mse</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">combo_mape</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">combo_pipe</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="n">preprocessing_rbf</span><span class="p">,</span> <span class="n">pca</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">combo_pipe</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">combo_pipe</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="n">combo_mse</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">combo_mape</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mape</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#error compilation
</span><span class="n">mse_results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">([</span><span class="n">mse</span><span class="p">,</span><span class="n">scaled_mse</span><span class="p">,</span><span class="n">pca_mse</span><span class="p">,</span> <span class="n">rbf_mse</span><span class="p">,</span> <span class="n">norm_mse</span><span class="p">,</span> <span class="n">combo_mse</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Unscaled</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Log price</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Reduced Dimensions</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">RBF Features</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Normalized Features</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Combination</span><span class="sh">'</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">model_names</span><span class="p">).</span><span class="n">T</span>
<span class="n">mape_results</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">([</span><span class="n">mape_err</span><span class="p">,</span><span class="n">scaled_mape</span><span class="p">,</span><span class="n">pca_mape</span><span class="p">,</span> <span class="n">rbf_mape</span><span class="p">,</span> <span class="n">norm_mape</span><span class="p">,</span> <span class="n">combo_mape</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Unscaled</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Log price</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Reduced Dimensions</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">RBF Features</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Normalized Features</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Combination</span><span class="sh">'</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">model_names</span><span class="p">).</span><span class="n">T</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#visualing results
</span><span class="n">mse_results</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">barh</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Regressor MSE</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100000</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">white</span><span class="sh">'</span><span class="p">)</span>

<span class="n">mape_results</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">barh</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Regressor MAPE</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">white</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_60_0.png" alt="MSE performance"></p>

<p><img src="/assets/img/airbnb_pipeline/output_60_1.png" alt="MAPE performance"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mse_results</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">'</span><span class="s">{:.0f}</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<style type="text/css">
</style>

<table id="T_81bd0_">
  <thead>
    <tr>
      <th class="blank level0">Â </th>
      <th class="col_heading level0 col0">Unscaled</th>
      <th class="col_heading level0 col1">Log price</th>
      <th class="col_heading level0 col2">Reduced Dimensions</th>
      <th class="col_heading level0 col3">RBF Features</th>
      <th class="col_heading level0 col4">Normalized Features</th>
      <th class="col_heading level0 col5">Combination</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_81bd0_level0_row0" class="row_heading level0 row0">Ridge</th>
      <td id="T_81bd0_row0_col0" class="data row0 col0">27182</td>
      <td id="T_81bd0_row0_col1" class="data row0 col1">25203</td>
      <td id="T_81bd0_row0_col2" class="data row0 col2">37715</td>
      <td id="T_81bd0_row0_col3" class="data row0 col3">27163</td>
      <td id="T_81bd0_row0_col4" class="data row0 col4">26996</td>
      <td id="T_81bd0_row0_col5" class="data row0 col5">32218</td>
    </tr>
    <tr>
      <th id="T_81bd0_level0_row1" class="row_heading level0 row1">ElasticNet</th>
      <td id="T_81bd0_row1_col0" class="data row1 col0">41868</td>
      <td id="T_81bd0_row1_col1" class="data row1 col1">49133</td>
      <td id="T_81bd0_row1_col2" class="data row1 col2">42977</td>
      <td id="T_81bd0_row1_col3" class="data row1 col3">41882</td>
      <td id="T_81bd0_row1_col4" class="data row1 col4">38034</td>
      <td id="T_81bd0_row1_col5" class="data row1 col5">49133</td>
    </tr>
    <tr>
      <th id="T_81bd0_level0_row2" class="row_heading level0 row2">SVR</th>
      <td id="T_81bd0_row2_col0" class="data row2 col0">33970</td>
      <td id="T_81bd0_row2_col1" class="data row2 col1">22371</td>
      <td id="T_81bd0_row2_col2" class="data row2 col2">37879</td>
      <td id="T_81bd0_row2_col3" class="data row2 col3">34282</td>
      <td id="T_81bd0_row2_col4" class="data row2 col4">42966</td>
      <td id="T_81bd0_row2_col5" class="data row2 col5">29286</td>
    </tr>
    <tr>
      <th id="T_81bd0_level0_row3" class="row_heading level0 row3">K-nearest neighbors</th>
      <td id="T_81bd0_row3_col0" class="data row3 col0">25041</td>
      <td id="T_81bd0_row3_col1" class="data row3 col1">24365</td>
      <td id="T_81bd0_row3_col2" class="data row3 col2">29786</td>
      <td id="T_81bd0_row3_col3" class="data row3 col3">26185</td>
      <td id="T_81bd0_row3_col4" class="data row3 col4">33192</td>
      <td id="T_81bd0_row3_col5" class="data row3 col5">29520</td>
    </tr>
    <tr>
      <th id="T_81bd0_level0_row4" class="row_heading level0 row4">Random Forest</th>
      <td id="T_81bd0_row4_col0" class="data row4 col0">13782</td>
      <td id="T_81bd0_row4_col1" class="data row4 col1">14281</td>
      <td id="T_81bd0_row4_col2" class="data row4 col2">25219</td>
      <td id="T_81bd0_row4_col3" class="data row4 col3">13657</td>
      <td id="T_81bd0_row4_col4" class="data row4 col4">13892</td>
      <td id="T_81bd0_row4_col5" class="data row4 col5">25716</td>
    </tr>
    <tr>
      <th id="T_81bd0_level0_row5" class="row_heading level0 row5">Extra Trees</th>
      <td id="T_81bd0_row5_col0" class="data row5 col0">11918</td>
      <td id="T_81bd0_row5_col1" class="data row5 col1">11824</td>
      <td id="T_81bd0_row5_col2" class="data row5 col2">25528</td>
      <td id="T_81bd0_row5_col3" class="data row5 col3">12174</td>
      <td id="T_81bd0_row5_col4" class="data row5 col4">13825</td>
      <td id="T_81bd0_row5_col5" class="data row5 col5">25473</td>
    </tr>
    <tr>
      <th id="T_81bd0_level0_row6" class="row_heading level0 row6">Adaptive Boosting</th>
      <td id="T_81bd0_row6_col0" class="data row6 col0">73914</td>
      <td id="T_81bd0_row6_col1" class="data row6 col1">33217</td>
      <td id="T_81bd0_row6_col2" class="data row6 col2">44755</td>
      <td id="T_81bd0_row6_col3" class="data row6 col3">186115</td>
      <td id="T_81bd0_row6_col4" class="data row6 col4">176752</td>
      <td id="T_81bd0_row6_col5" class="data row6 col5">40706</td>
    </tr>
    <tr>
      <th id="T_81bd0_level0_row7" class="row_heading level0 row7">Gradient Boosting</th>
      <td id="T_81bd0_row7_col0" class="data row7 col0">20228</td>
      <td id="T_81bd0_row7_col1" class="data row7 col1">22547</td>
      <td id="T_81bd0_row7_col2" class="data row7 col2">29095</td>
      <td id="T_81bd0_row7_col3" class="data row7 col3">20371</td>
      <td id="T_81bd0_row7_col4" class="data row7 col4">20465</td>
      <td id="T_81bd0_row7_col5" class="data row7 col5">30652</td>
    </tr>
    <tr>
      <th id="T_81bd0_level0_row8" class="row_heading level0 row8">XGBoost</th>
      <td id="T_81bd0_row8_col0" class="data row8 col0">15636</td>
      <td id="T_81bd0_row8_col1" class="data row8 col1">17635</td>
      <td id="T_81bd0_row8_col2" class="data row8 col2">27276</td>
      <td id="T_81bd0_row8_col3" class="data row8 col3">14857</td>
      <td id="T_81bd0_row8_col4" class="data row8 col4">16600</td>
      <td id="T_81bd0_row8_col5" class="data row8 col5">27639</td>
    </tr>
  </tbody>
</table>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mape_results</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">'</span><span class="s">{:.1f}</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<style type="text/css">
</style>

<table id="T_cf2f2_">
  <thead>
    <tr>
      <th class="blank level0">Â </th>
      <th class="col_heading level0 col0">Unscaled</th>
      <th class="col_heading level0 col1">Log price</th>
      <th class="col_heading level0 col2">Reduced Dimensions</th>
      <th class="col_heading level0 col3">RBF Features</th>
      <th class="col_heading level0 col4">Normalized Features</th>
      <th class="col_heading level0 col5">Combination</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_cf2f2_level0_row0" class="row_heading level0 row0">Ridge</th>
      <td id="T_cf2f2_row0_col0" class="data row0 col0">35.5</td>
      <td id="T_cf2f2_row0_col1" class="data row0 col1">25.4</td>
      <td id="T_cf2f2_row0_col2" class="data row0 col2">41.6</td>
      <td id="T_cf2f2_row0_col3" class="data row0 col3">35.4</td>
      <td id="T_cf2f2_row0_col4" class="data row0 col4">34.4</td>
      <td id="T_cf2f2_row0_col5" class="data row0 col5">30.2</td>
    </tr>
    <tr>
      <th id="T_cf2f2_level0_row1" class="row_heading level0 row1">ElasticNet</th>
      <td id="T_cf2f2_row1_col0" class="data row1 col0">52.2</td>
      <td id="T_cf2f2_row1_col1" class="data row1 col1">46.9</td>
      <td id="T_cf2f2_row1_col2" class="data row1 col2">53.3</td>
      <td id="T_cf2f2_row1_col3" class="data row1 col3">52.2</td>
      <td id="T_cf2f2_row1_col4" class="data row1 col4">43.3</td>
      <td id="T_cf2f2_row1_col5" class="data row1 col5">46.9</td>
    </tr>
    <tr>
      <th id="T_cf2f2_level0_row2" class="row_heading level0 row2">SVR</th>
      <td id="T_cf2f2_row2_col0" class="data row2 col0">25.7</td>
      <td id="T_cf2f2_row2_col1" class="data row2 col1">22.7</td>
      <td id="T_cf2f2_row2_col2" class="data row2 col2">29.2</td>
      <td id="T_cf2f2_row2_col3" class="data row2 col3">25.9</td>
      <td id="T_cf2f2_row2_col4" class="data row2 col4">35.9</td>
      <td id="T_cf2f2_row2_col5" class="data row2 col5">25.2</td>
    </tr>
    <tr>
      <th id="T_cf2f2_level0_row3" class="row_heading level0 row3">K-nearest neighbors</th>
      <td id="T_cf2f2_row3_col0" class="data row3 col0">27.2</td>
      <td id="T_cf2f2_row3_col1" class="data row3 col1">24.8</td>
      <td id="T_cf2f2_row3_col2" class="data row3 col2">30.3</td>
      <td id="T_cf2f2_row3_col3" class="data row3 col3">27.9</td>
      <td id="T_cf2f2_row3_col4" class="data row3 col4">32.5</td>
      <td id="T_cf2f2_row3_col5" class="data row3 col5">28.6</td>
    </tr>
    <tr>
      <th id="T_cf2f2_level0_row4" class="row_heading level0 row4">Random Forest</th>
      <td id="T_cf2f2_row4_col0" class="data row4 col0">18.4</td>
      <td id="T_cf2f2_row4_col1" class="data row4 col1">16.5</td>
      <td id="T_cf2f2_row4_col2" class="data row4 col2">28.1</td>
      <td id="T_cf2f2_row4_col3" class="data row4 col3">18.6</td>
      <td id="T_cf2f2_row4_col4" class="data row4 col4">20.0</td>
      <td id="T_cf2f2_row4_col5" class="data row4 col5">24.8</td>
    </tr>
    <tr>
      <th id="T_cf2f2_level0_row5" class="row_heading level0 row5">Extra Trees</th>
      <td id="T_cf2f2_row5_col0" class="data row5 col0">17.0</td>
      <td id="T_cf2f2_row5_col1" class="data row5 col1">15.2</td>
      <td id="T_cf2f2_row5_col2" class="data row5 col2">28.2</td>
      <td id="T_cf2f2_row5_col3" class="data row5 col3">17.1</td>
      <td id="T_cf2f2_row5_col4" class="data row5 col4">19.3</td>
      <td id="T_cf2f2_row5_col5" class="data row5 col5">24.9</td>
    </tr>
    <tr>
      <th id="T_cf2f2_level0_row6" class="row_heading level0 row6">Adaptive Boosting</th>
      <td id="T_cf2f2_row6_col0" class="data row6 col0">121.6</td>
      <td id="T_cf2f2_row6_col1" class="data row6 col1">56.8</td>
      <td id="T_cf2f2_row6_col2" class="data row6 col2">70.6</td>
      <td id="T_cf2f2_row6_col3" class="data row6 col3">205.0</td>
      <td id="T_cf2f2_row6_col4" class="data row6 col4">164.5</td>
      <td id="T_cf2f2_row6_col5" class="data row6 col5">56.9</td>
    </tr>
    <tr>
      <th id="T_cf2f2_level0_row7" class="row_heading level0 row7">Gradient Boosting</th>
      <td id="T_cf2f2_row7_col0" class="data row7 col0">27.3</td>
      <td id="T_cf2f2_row7_col1" class="data row7 col1">23.8</td>
      <td id="T_cf2f2_row7_col2" class="data row7 col2">32.8</td>
      <td id="T_cf2f2_row7_col3" class="data row7 col3">27.5</td>
      <td id="T_cf2f2_row7_col4" class="data row7 col4">27.0</td>
      <td id="T_cf2f2_row7_col5" class="data row7 col5">28.4</td>
    </tr>
    <tr>
      <th id="T_cf2f2_level0_row8" class="row_heading level0 row8">XGBoost</th>
      <td id="T_cf2f2_row8_col0" class="data row8 col0">24.2</td>
      <td id="T_cf2f2_row8_col1" class="data row8 col1">21.2</td>
      <td id="T_cf2f2_row8_col2" class="data row8 col2">29.7</td>
      <td id="T_cf2f2_row8_col3" class="data row8 col3">24.4</td>
      <td id="T_cf2f2_row8_col4" class="data row8 col4">24.4</td>
      <td id="T_cf2f2_row8_col5" class="data row8 col5">26.3</td>
    </tr>
  </tbody>
</table>

<div class="alert alert-block alert-success" style="font-size:18px; font-family:verdana; line-height: 1.7em;">
    ðŸ“Œ Â  The top performing regressor was the extra trees regressor with the log-transformed price.  </div>

<h2><br></h2>
<h2 id="optimizing-extra-trees-regression-model">Optimizing extra trees regression model</h2>

<h4 id="general-dependence-of-mse-on-number-of-estimators">General dependence of MSE on number of estimators</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span> 
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mse_n_est</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">n_estimators</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1001</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_estimators</span><span class="p">:</span>
    <span class="n">tree_opt</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="n">preprocessing</span><span class="p">,</span> <span class="nc">ExtraTreesRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="n">n</span><span class="p">))</span>
    <span class="n">tree_opt</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tree_opt</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="n">mse_n_est</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">n_estimators</span><span class="p">,</span><span class="n">mse_n_est</span><span class="p">,</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">n_estimators</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">mean squared error</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="/assets/img/airbnb_pipeline/output_67_0.png" alt="extra tree regressor tree number optimization"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Mean squared error at n_estimators = 500: </span><span class="si">{</span><span class="n">mse_n_est</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mean squared error at n_estimators = 500: 11796.
</code></pre></div></div>

<div class="alert alert-block alert-success" style="font-size:18px; font-family:verdana; line-height: 1.7em;">
    ðŸ“Œ Â   We will use 500 trees to optimize other model parameters, as this number minimizes the mean squared error without overfitting.  </div>

<h4 id="gridsearchcv">GridSearchCV</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#grid search 
</span>
<span class="n">tree_pipe</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span><span class="n">preprocessing</span><span class="p">,</span> <span class="nc">ExtraTreesRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>

<span class="n">n_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">]</span>
<span class="n">max_features</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">sqrt</span><span class="sh">'</span><span class="p">]</span> <span class="c1">#['sqrt','log2'] sqrt was shown to consistantly outperform log 
</span><span class="n">max_depth</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>


<span class="n">tree_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">extratreesregressor__n_estimators</span><span class="sh">'</span><span class="p">:</span><span class="n">n_estimators</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">extratreesregressor__max_features</span><span class="sh">'</span><span class="p">:</span><span class="n">max_features</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">extratreesregressor__max_depth</span><span class="sh">'</span><span class="p">:</span><span class="n">max_depth</span>
<span class="p">}</span>

<span class="n">tree_search</span> <span class="o">=</span> <span class="nc">GridSearchCV</span><span class="p">(</span><span class="n">tree_pipe</span><span class="p">,</span><span class="n">tree_params</span><span class="p">,</span><span class="n">scoring</span><span class="o">=</span><span class="sh">'</span><span class="s">neg_root_mean_squared_error</span><span class="sh">'</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">tree_search</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
<span class="n">tree_search</span><span class="p">.</span><span class="n">best_score_</span><span class="p">,</span><span class="n">tree_search</span><span class="p">.</span><span class="n">best_params_</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/opt/conda/lib/python3.7/site-packages/joblib/externals/loky/process_executor.py:703: UserWarning: A worker stopped while some jobs were given to the executor. This can be caused by a too short worker timeout or by a memory leak.
  "timeout or by a memory leak.", UserWarning





(-0.27009412940530914,
 {'extratreesregressor__max_depth': 30,
  'extratreesregressor__max_features': 'sqrt',
  'extratreesregressor__n_estimators': 500})
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y_pred</span> <span class="o">=</span> <span class="n">tree_search</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">y_pred</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>16595.141980500048
</code></pre></div></div>

<p>Constraining the max_depth appears to weaken the predictive power of the extra trees regressor in this case. Therefore, only n_estimators will be adjusted as a hyperparameter and the lowest MSE is 11,788.</p>

<h1><br></h1>
<h1>  Conclusion </h1>

<p>The analysis done in this project enables us to build an optimized pipeline for predicting Airbnb prices. The steps in this pipeline are summarized below:</p>

<ol>
  <li>Attraction index, restaurant index, city center and metro index are log-transformed.</li>
  <li>Room type and city are encoded.</li>
  <li>Data is scaled using a min-max scaling strategy.</li>
  <li>Housing prices are log-transformed.</li>
  <li>Log-price is predicted using a trained and optimized random forest regressor</li>
  <li>Price is transformed back to linear space.</li>
</ol>

<p><br>
The top performing model on this dataset is defined for clarity below:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="sh">'</span><span class="s">diagram</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">transformer</span> <span class="o">=</span> <span class="nc">FunctionTransformer</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">,</span> <span class="n">inverse_func</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">)</span>
<span class="n">regressor</span> <span class="o">=</span> <span class="nc">TransformedTargetRegressor</span><span class="p">(</span><span class="n">regressor</span><span class="o">=</span><span class="nc">ExtraTreesRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
                                      <span class="n">transformer</span><span class="o">=</span><span class="n">transformer</span><span class="p">)</span>

<span class="n">top_pipeline</span> <span class="o">=</span> <span class="nf">make_pipeline</span><span class="p">(</span>
    <span class="n">preprocessing</span><span class="p">,</span> 
    <span class="n">regressor</span><span class="p">)</span>

<span class="n">top_pipeline</span>
</code></pre></div></div>

<style>#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 {color: black;background-color: white;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 pre{padding: 0;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-toggleable {background-color: white;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-item {z-index: 1;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-parallel-item:only-child::after {width: 0;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3 div.sk-text-repr-fallback {display: none;}</style>
<div id="sk-24dc161d-9ff3-4410-baaa-6cc977b7c5c3" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('day',
                                                  Pipeline(steps=[('functiontransformer',
                                                                   FunctionTransformer(func=&lt;function day_2_num at 0x71e88f7d0440&gt;))]),
                                                  ['Day']),
                                                 ('drop', 'drop',
                                                  ['Normalised Attraction '
                                                   'Index',
                                                   'Normalised Restraunt Index',
                                                   'rbf_metro', 'rbf_city',
                                                   'rbf_res']),
                                                 ('pass', 'passthrough',
                                                  ['Private Room',
                                                   'Shared Room', 'Su...
                                                                   MinMaxScaler())]),
                                                  ['Attraction Index',
                                                   'City Center (km)',
                                                   'Metro Distance (km)',
                                                   'Restraunt Index']),
                                                 ('cat', OneHotEncoder(),
                                                  ['Room Type', 'City'])])),
                ('transformedtargetregressor',
                 TransformedTargetRegressor(regressor=ExtraTreesRegressor(n_estimators=500,
                                                                          n_jobs=-1,
                                                                          random_state=10),
                                            transformer=FunctionTransformer(func=&lt;ufunc 'log'&gt;,
                                                                            inverse_func=&lt;ufunc 'exp'&gt;)))])</pre>
<b>Please rerun this cell to show the HTML repr or trust the notebook.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="5565bc88-e9b9-44c7-978f-49a485e86364" type="checkbox"><label for="5565bc88-e9b9-44c7-978f-49a485e86364" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('columntransformer',
                 ColumnTransformer(transformers=[('day',
                                                  Pipeline(steps=[('functiontransformer',
                                                                   FunctionTransformer(func=&lt;function day_2_num at 0x71e88f7d0440&gt;))]),
                                                  ['Day']),
                                                 ('drop', 'drop',
                                                  ['Normalised Attraction '
                                                   'Index',
                                                   'Normalised Restraunt Index',
                                                   'rbf_metro', 'rbf_city',
                                                   'rbf_res']),
                                                 ('pass', 'passthrough',
                                                  ['Private Room',
                                                   'Shared Room', 'Su...
                                                                   MinMaxScaler())]),
                                                  ['Attraction Index',
                                                   'City Center (km)',
                                                   'Metro Distance (km)',
                                                   'Restraunt Index']),
                                                 ('cat', OneHotEncoder(),
                                                  ['Room Type', 'City'])])),
                ('transformedtargetregressor',
                 TransformedTargetRegressor(regressor=ExtraTreesRegressor(n_estimators=500,
                                                                          n_jobs=-1,
                                                                          random_state=10),
                                            transformer=FunctionTransformer(func=&lt;ufunc 'log'&gt;,
                                                                            inverse_func=&lt;ufunc 'exp'&gt;)))])</pre></div>
</div></div>
<div class="sk-serial">
<div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="3c89f2db-f3b0-48ab-90c8-602b92fcae26" type="checkbox"><label for="3c89f2db-f3b0-48ab-90c8-602b92fcae26" class="sk-toggleable__label sk-toggleable__label-arrow">columntransformer: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('day',
                                 Pipeline(steps=[('functiontransformer',
                                                  FunctionTransformer(func=&lt;function day_2_num at 0x71e88f7d0440&gt;))]),
                                 ['Day']),
                                ('drop', 'drop',
                                 ['Normalised Attraction Index',
                                  'Normalised Restraunt Index', 'rbf_metro',
                                  'rbf_city', 'rbf_res']),
                                ('pass', 'passthrough',
                                 ['Private Room', 'Shared Room', 'Superhost',
                                  'Business', 'Multiple Rooms']),
                                ('maxscale', MinMaxScaler(),
                                 ['Cleanliness Rating', 'Bedrooms',
                                  'Guest Satisfaction']),
                                ('log',
                                 Pipeline(steps=[('functiontransformer',
                                                  FunctionTransformer(func=&lt;ufunc 'log'&gt;)),
                                                 ('minmaxscaler',
                                                  MinMaxScaler())]),
                                 ['Attraction Index', 'City Center (km)',
                                  'Metro Distance (km)', 'Restraunt Index']),
                                ('cat', OneHotEncoder(),
                                 ['Room Type', 'City'])])</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="8dfbdfcc-4c8b-45a7-8f23-4110fd67eb84" type="checkbox"><label for="8dfbdfcc-4c8b-45a7-8f23-4110fd67eb84" class="sk-toggleable__label sk-toggleable__label-arrow">day</label><div class="sk-toggleable__content"><pre>['Day']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="1bb7d3bb-356f-4196-999f-e54e6ae7847c" type="checkbox"><label for="1bb7d3bb-356f-4196-999f-e54e6ae7847c" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;function day_2_num at 0x71e88f7d0440&gt;)</pre></div>
</div></div></div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="4fdd4622-e3eb-4298-8ba6-63d39ab32a38" type="checkbox"><label for="4fdd4622-e3eb-4298-8ba6-63d39ab32a38" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>['Normalised Attraction Index', 'Normalised Restraunt Index', 'rbf_metro', 'rbf_city', 'rbf_res']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="8b1c406e-d27c-4a9d-b1e2-0270bac5c14a" type="checkbox"><label for="8b1c406e-d27c-4a9d-b1e2-0270bac5c14a" class="sk-toggleable__label sk-toggleable__label-arrow">drop</label><div class="sk-toggleable__content"><pre>drop</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="066689e8-1740-4c48-9dff-c9b46eb0f5e7" type="checkbox"><label for="066689e8-1740-4c48-9dff-c9b46eb0f5e7" class="sk-toggleable__label sk-toggleable__label-arrow">pass</label><div class="sk-toggleable__content"><pre>['Private Room', 'Shared Room', 'Superhost', 'Business', 'Multiple Rooms']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="daf391ba-38ac-4669-9127-66dfe4787e44" type="checkbox"><label for="daf391ba-38ac-4669-9127-66dfe4787e44" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="cf136e71-56f5-488d-a105-371c8da25e0c" type="checkbox"><label for="cf136e71-56f5-488d-a105-371c8da25e0c" class="sk-toggleable__label sk-toggleable__label-arrow">maxscale</label><div class="sk-toggleable__content"><pre>['Cleanliness Rating', 'Bedrooms', 'Guest Satisfaction']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="2d27d587-0c58-431d-9300-3dfc193aa07f" type="checkbox"><label for="2d27d587-0c58-431d-9300-3dfc193aa07f" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="e57ce64a-095e-46c6-ae8b-b3334ffb29e3" type="checkbox"><label for="e57ce64a-095e-46c6-ae8b-b3334ffb29e3" class="sk-toggleable__label sk-toggleable__label-arrow">log</label><div class="sk-toggleable__content"><pre>['Attraction Index', 'City Center (km)', 'Metro Distance (km)', 'Restraunt Index']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-serial">
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="0f5c483b-d6b5-49c0-962d-c03b96fe3769" type="checkbox"><label for="0f5c483b-d6b5-49c0-962d-c03b96fe3769" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;ufunc 'log'&gt;)</pre></div>
</div></div>
<div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="0910d8eb-f422-4fa1-bd78-7df09d6374e8" type="checkbox"><label for="0910d8eb-f422-4fa1-bd78-7df09d6374e8" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div>
</div></div>
</div></div></div>
</div></div>
<div class="sk-parallel-item"><div class="sk-item">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="fb766bd5-62de-46bf-baaf-dc7d1dd844dd" type="checkbox"><label for="fb766bd5-62de-46bf-baaf-dc7d1dd844dd" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>['Room Type', 'City']</pre></div>
</div></div>
<div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="48c8ef26-5d65-4c79-a716-fdaf38669365" type="checkbox"><label for="48c8ef26-5d65-4c79-a716-fdaf38669365" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder()</pre></div>
</div></div></div>
</div></div>
</div>
</div>
<div class="sk-item sk-dashed-wrapped">
<div class="sk-label-container"><div class="sk-label sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="23f86c80-c408-4209-a9e0-4bd71a200a1b" type="checkbox"><label for="23f86c80-c408-4209-a9e0-4bd71a200a1b" class="sk-toggleable__label sk-toggleable__label-arrow">transformedtargetregressor: TransformedTargetRegressor</label><div class="sk-toggleable__content"><pre>TransformedTargetRegressor(regressor=ExtraTreesRegressor(n_estimators=500,
                                                         n_jobs=-1,
                                                         random_state=10),
                           transformer=FunctionTransformer(func=&lt;ufunc 'log'&gt;,
                                                           inverse_func=&lt;ufunc 'exp'&gt;))</pre></div>
</div></div>
<div class="sk-parallel">
<div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="0c7c49a6-28ec-42d3-a69d-15a38700d1ec" type="checkbox"><label for="0c7c49a6-28ec-42d3-a69d-15a38700d1ec" class="sk-toggleable__label sk-toggleable__label-arrow">ExtraTreesRegressor</label><div class="sk-toggleable__content"><pre>ExtraTreesRegressor(n_estimators=500, n_jobs=-1, random_state=10)</pre></div>
</div></div></div></div></div>
<div class="sk-parallel-item"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="82524cbd-6a16-4990-8b68-84008f5d08a0" type="checkbox"><label for="82524cbd-6a16-4990-8b68-84008f5d08a0" class="sk-toggleable__label sk-toggleable__label-arrow">FunctionTransformer</label><div class="sk-toggleable__content"><pre>FunctionTransformer(func=&lt;ufunc 'log'&gt;, inverse_func=&lt;ufunc 'exp'&gt;)</pre></div>
</div></div></div></div></div>
</div>
</div>
</div>
</div></div>
</div>

<p>And the mean squared error from this pipeline is 11,788.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">top_pipeline</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">top_pipeline</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>11787.637281203217
</code></pre></div></div>


          </article>

        </div>
      
    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        Â© Copyright 2023 Nina  Cilliers. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script>

  <!-- Bootstrap Table -->
  <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script>

  <!-- Load Common JS -->
  <script src="/assets/js/no_defer.js"></script>
  <script defer src="/assets/js/common.js"></script>
  <script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
